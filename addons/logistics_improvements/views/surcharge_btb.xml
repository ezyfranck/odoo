<?xml version="1.0" encoding="utf-8" ?>
<openerp>
    <data>


        <!--         ############### Form view ############### -->


        <record model="ir.ui.view" id="logistic_order_btb_form">
            <field name="name">logistic.sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <form string="Bon de commande btb">
                    <header>
                        <field name="parent_id" invisible="1" />
                        <button
              name="action_view_parent"
              string="View Parent Sales Order"
              type="object"
              class="oe_highlight"
              attrs="{'invisible': [('parent_id', '=', False)]}"
              groups="base.group_user"
            />
                        <button
              name="invoice_recreate"
              states="invoice_except"
              string="Recreate Invoice"
              groups="base.group_user"
            />
                        <button
              name="invoice_corrected"
              states="invoice_except"
              string="Ignore Exception"
              groups="base.group_user"
            />
                        <button
              name="action_quotation_send"
              string="Send by Email"
              type="object"
              states="draft"
              class="oe_highlight"
              groups="base.group_user"
            />
                        <button
              name="action_quotation_send"
              string="Send by Email"
              type="object"
              states="sent,progress,manual"
              groups="base.group_user"
            />
                        <!-- <button name="print_quotation" string="Print" type="object" states="draft" class="oe_highlight" groups="base.group_user" />
                        <button name="print_quotation" string="Print" type="object" states="sent,progress,manual" groups="base.group_user" /> -->
                        <button
              name="action_button_confirm"
              states="draft"
              string="Confirm Sale"
              type="object"
              groups="base.group_user"
            />
                        <button
              name="action_button_confirm"
              states="sent"
              string="Confirm Sale"
              class="oe_highlight"
              type="object"
              groups="base.group_user"
            />
                        <button
              name="action_view_invoice"
              string="View Invoice"
              type="object"
              class="oe_highlight"
              attrs="{'invisible': [('invoice_exists', '=', False)]}"
              groups="base.group_user"
            />
                        <button
              name="352"
              string="Create Invoice"
              type="action"
              states="manual,l4_preparation,l4_shipped"
              class="oe_highlight"
              groups="base.group_user"
            />
                        <button
              name="copy_quotation"
              states="cancel"
              string="New Copy of Quotation"
              type="object"
            />
                        <button
              name="cancel"
              states="draft,sent"
              string="Cancel Quotation"
              groups="base.group_user"
            />
                        <button
              name="action_cancel"
              states="manual,progress,l4_preparation,l4_shipped"
              string="Cancel Order"
              type="object"
              groups="base.group_user"
            />
                        <button
              name="invoice_cancel"
              states="invoice_except"
              string="Cancel Order"
              groups="base.group_user"
            />
                        <button
              name="474"
              type="action"
              attrs="{'invisible': ['|', '|', ('canceled_in_backend', '=', False), ('cancellation_resolved', '=', True), ('state', '==', 'cancel')]}"
              string="Ignore backend's cancellation, Keep Open"
              groups="base.group_sale_manager"
            />
                        <field
              name="state"
              widget="statusbar"
              statusbar_visible="draft,sent,progress,done"
              statusbar_colors="{&quot;invoice_except&quot;:&quot;red&quot;,&quot;waiting_date&quot;:&quot;blue&quot;}"
            />
                    </header>
                    <sheet>
                        <h1>
                            <label
                string="Quotation "
                attrs="{'invisible': [('state','not in',('draft','sent'))]}"
              />
                            <label
                string="Sales Order "
                attrs="{'invisible': [('state','in',('draft','sent'))]}"
              />
                            <field name="name" class="oe_inline" readonly="1" />
                        </h1>
                        <group>
                            <group>
                                <field
                  name="partner_id"
                  on_change="onchange_partner_id(partner_id, context)"
                  domain="[('customer','=',True)]"
                  context="{'search_default_customer':1, 'show_address': 1}"
                  options="{&quot;always_reload&quot;: True}"
                />
                                <field
                  name="partner_invoice_id"
                  groups="sale.group_delivery_invoice_address"
                  context="{'default_type':'invoice'}"
                />
                                <field
                  name="partner_shipping_id"
                  on_change="onchange_delivery_id(company_id, partner_id, partner_shipping_id, fiscal_position)"
                  groups="sale.group_delivery_invoice_address"
                  context="{'default_type':'delivery'}"
                />
                                <field
                  name="project_id"
                  context="{'partner_id':partner_invoice_id, 'manager_id': user_id, 'default_pricelist_id':pricelist_id, 'default_name':name, 'default_type': 'contract'}"
                  groups="sale.group_analytic_accounting"
                  domain="[('type','in',['view','normal','contract'])]"
                />
                            </group>
                            <group>
                                <field name="date_order" />
                                <field name="client_order_ref" />
                                <field
                  domain="[('type','=','sale')]"
                  name="pricelist_id"
                  groups="product.group_sale_pricelist"
                  on_change="onchange_pricelist_id(pricelist_id,order_line)"
                />
                                <field name="currency_id" invisible="1" />
                            </group>
                        </group>
                        <notebook>
                            <page string="Order Lines">
                                <field name="order_line">
                                    <form string="Sales Order Lines">
                                        <header groups="base.group_user">
                                            <button
                        name="353"
                        states="confirmed"
                        string="Invoice"
                        type="action"
                        icon="terp-document-new"
                      />
                                            <field
                        name="state"
                        widget="statusbar"
                        statusbar_visible="draft,confirmed,done"
                        statusbar_colors="{&quot;exception&quot;:&quot;red&quot;,&quot;cancel&quot;:&quot;red&quot;}"
                      />
                                        </header>
                                        <group>
                                            <group>
                                                <field
                          name="product_id"
                          context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                          groups="base.group_user"
                          on_change="product_id_change(parent.pricelist_id, product_id, product_uom_qty, False, product_uos_qty, False, name, parent.partner_id, False, True, parent.date_order, False, parent.fiscal_position, False, context)"
                        />
                                                <field name="product_categ" />
                                                <label for="product_uom_qty" />
                                                <div>
                                                    <field
                            context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'uom_qty_change':True, 'company_id': parent.company_id}"
                            name="product_uom_qty"
                            class="oe_inline"
                            on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, False, False, parent.date_order, False, parent.fiscal_position, True, context)"
                          />
                                                    <field
                            name="product_uom"
                            groups="product.group_uom"
                            class="oe_inline oe_no_button"
                            context="{'company_id': parent.company_id}"
                            on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, False, False, parent.date_order, context)"
                          />
                                                </div>
                                                <label
                          for="product_uos_qty"
                          groups="product.group_uos"
                        />
                                                <div groups="product.group_uos">
                                                    <field
                            name="product_uos_qty"
                            class="oe_inline"
                          />
                                                    <field
                            name="product_uos"
                            options="{&quot;no_open&quot;: True}"
                            class="oe_inline"
                          />
                                                </div>
                                                <!--<field name="price_ht" />-->
                                                <field
                          name="price_unit"
                          string="Prix Hors taxe"
                        />
                                                <label
                          for="discount"
                          groups="sale.group_discount_per_so_line"
                        />
                                                <div
                          name="discount"
                          groups="sale.group_discount_per_so_line"
                        >
                                                    <field
                            name="discount"
                            class="oe_inline"
                          />
                                                    %
                                                </div>
                                            </group>
                                            <group>
                                                <field
                          name="tax_id"
                          widget="many2many_tags"
                          domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]"
                        />
                                                <field name="th_weight" />
                                                <!-- we should put a config wizard for these two fields -->
                                                <field
                          name="address_allotment_id"
                        />
                                            </group>
                                        </group>
                                        <label for="name" />
                                        <field name="name" />
                                        <div groups="base.group_no_one">
                                            <label for="invoice_lines" />
                                            <field name="invoice_lines" />
                                        </div>
                                    </form>
                                    <tree string="Sales Order Lines">
                                        <field
                      name="sequence"
                      widget="handle"
                    />
                                        <field name="state" invisible="1" />
                                        <field name="th_weight" invisible="1" />
                                        <field
                      name="product_id"
                      context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                      groups="base.group_user"
                      on_change="product_id_change(parent.pricelist_id, product_id, product_uom_qty, False, product_uos_qty, False, name, parent.partner_id, False, True, parent.date_order, False, parent.fiscal_position, False, context)"
                    />
                                        <field name="product_categ" />
                                        <field
                      name="product_uom_qty"
                      context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                      on_change="product_id_change(parent.pricelist_id, product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.partner_id, False, False, parent.date_order, False, parent.fiscal_position, True, context)"
                    />
                                        <field
                      name="product_uom"
                      context="{'company_id': parent.company_id}"
                      on_change="product_uom_change(parent.pricelist_id, product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.partner_id, False, False, parent.date_order, context)"
                      groups="product.group_uom"
                      options="{&quot;no_open&quot;: True}"
                    />
                                        <field
                      name="product_uos_qty"
                      groups="product.group_uos"
                      invisible="1"
                    />
                                        <field
                      name="product_uos"
                      string="UoS"
                      groups="product.group_uos"
                      invisible="1"
                    />
                                        <field
                      name="price_unit"
                      string="Prix Hors taxe"
                    />
                                        <field
                      name="tax_id"
                      widget="many2many_tags"
                      domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]"
                    />
                                        <field
                      name="discount"
                      groups="sale.group_discount_per_so_line"
                    />
                                        <field name="price_subtotal" />
                                    </tree>
                                </field>
                                <group
                  class="oe_subtotal_footer oe_right"
                  colspan="2"
                  name="sale_total"
                >
                                    <field
                    name="amount_untaxed"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                    <field
                    name="amount_tax"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                    <div
                    class="oe_subtotal_footer_separator oe_inline"
                  >
                                        <label for="amount_total" />
                                        <button
                      name="button_dummy"
                      states="draft,sent"
                      string="(update)"
                      type="object"
                      class="oe_edit_only oe_link"
                    />
                                    </div>
                                    <field
                    name="amount_total"
                    nolabel="1"
                    class="oe_subtotal_footer_separator"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                </group>
                                <div class="oe_clear" />
                                <field
                  name="note"
                  class="oe_inline"
                  placeholder="Terms and conditions..."
                />
                            </page>
                            <page
                string="Other Information"
                groups="base.group_user"
              >
                                <group>
                                    <group
                    name="sales_person"
                    groups="base.group_user"
                  >
                                        <field
                      name="user_id"
                      context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_invoice', 'base.group_sale_salesman_all_leads']}"
                    />
                                        <field
                      name="section_id"
                      options="{'no_create': True}"
                      groups="base.group_multi_salesteams"
                    />
                                        <field
                      groups="base.group_no_one"
                      name="origin"
                    />
                                    </group>
                                    <group name="sale_pay">
                                        <field
                      name="payment_term"
                      options="{'no_create': True}"
                    />
                                        <field
                      name="fiscal_position"
                      options="{'no_create': True}"
                      on_change="onchange_fiscal_position(fiscal_position, order_line, context)"
                    />
                                        <field
                      name="company_id"
                      widget="selection"
                      groups="base.group_multi_company"
                    />
                                    </group>
                                    <group>
                                        <field name="invoiced" />
                                        <field
                      name="invoice_exists"
                      invisible="1"
                    />
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field
              name="message_follower_ids"
              widget="mail_followers"
              groups="base.group_user"
            />
                        <field name="message_ids" widget="mail_thread" />
                    </div>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="logistic_invoice_btb_form">
            <field name="name">logistic.account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field name="arch" type="xml">
                <form string="Facture btb">
                    <header>
                        <button
              name="action_invoice_sent"
              type="object"
              string="Send by Email"
              attrs="{'invisible':['|',('sent','=',True), ('state', '!=', 'open')]}"
              class="oe_highlight"
              groups="base.group_user"
            />
                        <button
              name="invoice_print"
              string="Print"
              type="object"
              attrs="{'invisible':['|',('sent','=',True), ('state', '!=', 'open')]}"
              class="oe_highlight"
              groups="base.group_user"
            />
                        <button
              name="action_invoice_sent"
              type="object"
              string="Send by Email"
              attrs="{'invisible':['|',('sent','=',False), ('state', '!=', 'open')]}"
              groups="base.group_user"
            />
                        <button
              name="invoice_print"
              string="Print Invoice"
              type="object"
              attrs="{'invisible':['|',('sent','=',False), ('state', '!=', 'open')]}"
              groups="base.group_user"
            />
                        <button
              name="invoice_open"
              states="draft"
              string="Validate"
              class="oe_highlight"
              groups="base.group_user"
            />
                        <button
              name="invoice_open"
              states="proforma2"
              string="Validate"
              groups="base.group_user"
            />
                        <button
              name="invoice_proforma2"
              states="draft"
              string="PRO-FORMA"
              groups="account.group_proforma_invoices"
            />
                        <button
              name="217"
              type="action"
              string="Refund Invoice"
              states="open,proforma2,paid"
              groups="base.group_user"
            />
                        <button
              name="invoice_cancel"
              states="draft,proforma2,open"
              string="Cancel Invoice"
              groups="base.group_no_one"
            />
                        <button
              name="action_cancel_draft"
              states="cancel"
              string="Reset to Draft"
              type="object"
              groups="base.group_user"
            />
                        <button
              name="231"
              type="action"
              string="Re-Open"
              groups="account.group_account_invoice"
              attrs="{'invisible':['|', ('state','&lt;&gt;','paid'), ('reconciled', '=', True)]}"
              help="This button only appears when the state of the invoice is 'paid' (showing that it has been fully reconciled) and auto-computed boolean 'reconciled' is False (depicting that it's not the case anymore). In other words, the invoice has been dereconciled and it does not fit anymore the 'paid' state. You should press this button to re-open it and let it continue its normal process after having resolved the eventual exceptions it may have created."
            />
                        <!--button name="203" string="Print Invoice" type="action" states="open,paid,proforma,sale,proforma2"/-->
                        <field
              name="state"
              widget="statusbar"
              nolabel="1"
              statusbar_visible="draft,open,paid"
              statusbar_colors="{&quot;proforma&quot;:&quot;blue&quot;,&quot;proforma2&quot;:&quot;blue&quot;}"
            />
                    </header>
                    <sheet string="Invoice">
                        <h1>
                            <label
                string="Draft Invoice"
                attrs="{'invisible': ['|',('state','not in',('draft',)), ('type','&lt;&gt;','out_invoice')]}"
              />
                            <label
                string="Draft Refund"
                attrs="{'invisible': ['|',('state','not in',('draft',)), ('type','&lt;&gt;','out_refund')]}"
              />
                            <label
                string="Pro Forma Invoice"
                attrs="{'invisible': [('state','not in',('proforma','proforma2'))]}"
              />
                            <label
                string="Invoice"
                attrs="{'invisible': ['|',('state','in',('draft','proforma','proforma2')), ('type','&lt;&gt;','out_invoice')]}"
              />
                            <label
                string="Refund"
                attrs="{'invisible': ['|',('state','in',('draft','proforma','proforma2')), ('type','&lt;&gt;','out_refund')]}"
              />
                            <field
                name="number"
                readonly="1"
                class="oe_inline"
              />
                        </h1>
                        <field name="type" invisible="1" />
                        <group>
                            <group>
                                <field
                  string="Customer"
                  name="partner_id"
                  on_change="onchange_partner_id(type, partner_id, date_invoice, payment_term, partner_bank_id, company_id, context)"
                  context="{'search_default_customer':1, 'show_address': 1}"
                  options="{&quot;always_reload&quot;: True}"
                  domain="[('customer', '=', True)]"
                />
                                <field
                  name="fiscal_position"
                  options="{'no_create': True}"
                />
                            </group>
                            <group>
                                <field
                  name="date_invoice"
                  on_change="onchange_payment_term_date_invoice(payment_term, date_invoice)"
                />
                                <field name="internal_number" invisible="1" />
                                <field
                  name="journal_id"
                  groups="account.group_account_user"
                  on_change="onchange_journal_id(journal_id)"
                  options="{'no_create': True}"
                  attrs="{'readonly':[('internal_number','!=',False)]}"
                />
                                <field
                  domain="[('company_id', '=', company_id),('type','=', 'receivable')]"
                  name="account_id"
                  groups="account.group_account_user"
                />

                                <label
                  for="currency_id"
                  groups="base.group_multi_currency"
                />
                                <div groups="base.group_multi_currency">
                                    <field
                    name="currency_id"
                    class="oe_inline"
                  />
                                    <button
                    name="233"
                    type="action"
                    class="oe_inline oe_link oe_edit_only"
                    string="(change)"
                    attrs="{'invisible':[('state','!=','draft')]}"
                    groups="account.group_account_user"
                  />
                                </div>
                            </group>
                        </group>
                        <field name="sent" invisible="1" />
                        <notebook colspan="4">
                            <page string="Invoice Lines">
                                <field
                  name="invoice_line"
                  nolabel="1"
                  widget="one2many_list"
                  context="{'type': type}"
                >
                                    <form string="Invoice Line">
                                        <group>
                                            <group>
                                                <field
                          name="product_id"
                          on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)"
                        />
                                                <field name="product_categ" />
                                                <label for="quantity" />
                                                <div>
                                                    <field
                            name="quantity"
                            class="oe_inline"
                          />
                                                    <field
                            name="uos_id"
                            class="oe_inline"
                            groups="product.group_uom"
                            on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)"
                          />
                                                </div>
                                                <field
                          name="price_unit"
                          string="Prix Hors taxe"
                        />
                                                <field
                          name="discount"
                          groups="sale.group_discount_per_so_line"
                        />
                                            </group>
                                            <group>
                                                <field
                          domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]"
                          name="account_id"
                          on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position,account_id)"
                          groups="account.group_account_user"
                        />
                                                <field
                          name="invoice_line_tax_id"
                          context="{'type':parent.get('type')}"
                          domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"
                          widget="many2many_tags"
                        />
                                                <field
                          domain="[('type','&lt;&gt;','view'), ('company_id', '=', parent.company_id), ('state','not in',('close','cancelled'))]"
                          name="account_analytic_id"
                          groups="analytic.group_analytic_accounting"
                        />
                                                <field
                          name="company_id"
                          groups="base.group_multi_company"
                          readonly="1"
                        />
                                            </group>
                                        </group>
                                        <label for="name" />
                                        <field name="name" />
                                    </form>
                                    <tree string="Invoice Lines">
                                        <field
                      name="sequence"
                      widget="handle"
                    />
                                        <field
                      name="product_id"
                      on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)"
                    />
                                        <field name="product_categ" />
                                        <field
                      name="company_id"
                      invisible="1"
                    />
                                        <field
                      name="account_id"
                      groups="account.group_account_user"
                      domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '=', 'other')]"
                      on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position,account_id)"
                    />
                                        <field
                      name="account_analytic_id"
                      groups="analytic.group_analytic_accounting"
                      domain="[('type','!=','view'), ('company_id', '=', parent.company_id), ('state','not in',('close','cancelled'))]"
                    />
                                        <field name="quantity" />
                                        <field
                      name="uos_id"
                      groups="product.group_uom"
                      on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)"
                    />
                                        <field
                      name="price_unit"
                      string="Prix Hors taxe"
                    />
                                        <field
                      name="discount"
                      groups="sale.group_discount_per_so_line"
                    />
                                        <field
                      name="invoice_line_tax_id"
                      widget="many2many_tags"
                      context="{'type':parent.type}"
                      domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"
                    />
                                        <field name="price_subtotal" />
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field
                    name="amount_untaxed"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                    <div>
                                        <label for="amount_tax" />
                                        <button
                      name="button_reset_taxes"
                      states="draft,proforma2"
                      string="(update)"
                      class="oe_link oe_edit_only"
                      type="object"
                      help="Recompute taxes and total"
                    />
                                    </div>
                                    <field
                    name="amount_tax"
                    nolabel="1"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                    <field
                    name="amount_total"
                    class="oe_subtotal_footer_separator"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                    <field
                    name="residual"
                    groups="account.group_account_user"
                    widget="monetary"
                    options="{'currency_field': 'currency_id'}"
                  />
                                    <field name="reconciled" invisible="1" />
                                </group>
                                <group>
                                    <field
                    name="payment_term"
                    class="oe_inline"
                    on_change="onchange_payment_term_date_invoice(payment_term, date_invoice)"
                  />
                                </group>
                                <div class="oe_clear">
                                    <label for="comment" />
                                </div>
                                <field
                  name="comment"
                  class="oe_inline"
                  placeholder="Additional notes..."
                />
                            </page>
                            <page string="Other Info">
                                <group col="4">
                                    <group>
                                        <field
                      name="company_id"
                      on_change="onchange_company_id(company_id,partner_id,type,invoice_line,currency_id)"
                      widget="selection"
                      groups="base.group_multi_company"
                    />
                                        <field
                      name="user_id"
                      groups="base.group_user"
                      context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_invoice']}"
                    />
                                        <field
                      domain="[('partner_id.ref_companies', 'in', [company_id])]"
                      name="partner_bank_id"
                    />
                                        <field
                      name="period_id"
                      domain="[('state', '=', 'draft'), ('company_id', '=', company_id)]"
                      groups="account.group_account_manager"
                      string="Accounting Period"
                      placeholder="force period"
                    />
                                        <field name="date_due" />
                                    </group>
                                    <group>
                                        <field
                      name="origin"
                      groups="base.group_user"
                    />
                                        <field name="name" />
                                        <field
                      name="move_id"
                      groups="account.group_account_user"
                    />
                                    </group>
                                </group>
                                <field name="tax_line">
                                    <tree editable="bottom" string="Taxes">
                                        <field name="name" />
                                        <field
                      name="account_id"
                      groups="account.group_account_user"
                    />
                                        <field
                      name="base"
                      on_change="base_change(base,parent.currency_id,parent.company_id,parent.date_invoice)"
                      readonly="1"
                    />
                                        <field
                      name="amount"
                      on_change="amount_change(amount,parent.currency_id,parent.company_id,parent.date_invoice)"
                    />
                                        <field
                      invisible="True"
                      name="base_amount"
                    />
                                        <field
                      invisible="True"
                      name="tax_amount"
                    />
                                        <field
                      name="factor_base"
                      invisible="True"
                    />
                                        <field
                      name="factor_tax"
                      invisible="True"
                    />
                                    </tree>
                                </field>
                            </page>
                            <page string="Payments" groups="base.group_user">
                                <field name="payment_ids">
                                    <tree string="Payments">
                                        <field name="date" />
                                        <field name="move_id" />
                                        <field name="ref" />
                                        <field name="name" />
                                        <field
                      name="journal_id"
                      groups="base.group_user"
                    />
                                        <field name="debit" />
                                        <field name="credit" />
                                        <field
                      name="amount_currency"
                      groups="base.group_multi_currency"
                    />
                                        <field
                      name="currency_id"
                      groups="base.group_multi_currency"
                    />
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field
              name="message_follower_ids"
              widget="mail_followers"
              groups="base.group_user"
            />
                        <field name="message_ids" widget="mail_thread" />
                    </div>
                </form>
            </field>
        </record>

        <!-- ############### Actions ############### -->
        <record id="logistic_action_bc_btb" model="ir.actions.act_window">
            <field name="name">Bons de commande BTB</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id" />
            <field name="domain">[('typage','=','btb')]</field>
            <field
        name="context"
      >{ 'search_default_my_sale_orders_filter': 1 }</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter" />
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Gérez vos commandes BTB
                </p>
            </field>
        </record>

        <record
      id="logistic_order_btb_tree_view"
      model="ir.actions.act_window.view"
    >
            <field name="sequence">1</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sale.view_order_tree" />
            <field name="act_window_id" ref="logistic_action_bc_btb" />
        </record>

        <record
      id="logistic_order_btb_form_view"
      model="ir.actions.act_window.view"
    >
            <field name="sequence">3</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="logistic_order_btb_form" />
            <field name="act_window_id" ref="logistic_action_bc_btb" />
        </record>


        <record id="logistic_action_fact_btb" model="ir.actions.act_window">
            <field name="name">Factures BTB</field>
            <field name="res_model">account.invoice</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id" />
            <field
        name="domain"
      >[('type','=','out_invoice'),('typage','=','btb')]</field>
            <field
        name="context"
      >{'default_type':'out_invoice', 'type':'out_invoice', 'journal_type': 'sale'}</field>
            <field
        name="search_view_id"
        ref="account.view_account_invoice_filter"
      />
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Gérez vos factures BTB
                </p>
            </field>
        </record>

        <record
      id="logistic_invoice_btb_tree_view"
      model="ir.actions.act_window.view"
    >
            <field name="sequence">1</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="account.invoice_tree" />
            <field name="act_window_id" ref="logistic_action_fact_btb" />
        </record>

        <record
      id="logistic_invoice_btb_form_view"
      model="ir.actions.act_window.view"
    >
            <field name="sequence">3</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="logistic_invoice_btb_form" />
            <field name="act_window_id" ref="logistic_action_fact_btb" />
        </record>

        <!-- ############### Menus ############### -->

        <menuitem
      id="logistic_menu_bc_btb"
      action="logistic_action_bc_btb"
      parent="base.menu_sales"
      sequence="10"
    />


        <menuitem
      id="logistic_menu_fact_btb"
      action="logistic_action_fact_btb"
      parent="account.menu_finance_receivables"
      sequence="09"
    />


        <!-- ############### action de surchages pour btb ############### -->

        <record id="sale.action_quotations" model="ir.actions.act_window">
            <field name="name">logistic sale.action_quotations</field>
            <field name="res_model">sale.order</field>
            <field
        name="domain"
      >[('state','in',('draft','sent','cancel')),('typage','!=','btb')]</field>
        </record>

        <record id="sale.action_orders" model="ir.actions.act_window">
            <field name="name">logistic sale.action_orders</field>
            <field name="res_model">sale.order</field>
            <field
        name="domain"
      >[('state', 'not in', ('draft', 'sent', 'cancel')),('typage','!=','btb')]</field>
        </record>

        <record id="account.action_invoice_tree1" model="ir.actions.act_window">
            <field name="name">logistic account_action_invoice_tree1</field>
            <field name="res_model">account.invoice</field>
            <field
        name="domain"
      >[('type','=','out_invoice'),('typage','!=','btb')]</field>
        </record>

        <!-- ############### views de surchages pour btb ############### -->
        <record model="ir.ui.view" id="logistic_view_order_withcarrier_form">
            <field name="name">logistic.view.order.withcarrier.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">

                <xpath expr="//group[@name='sale_total']" position="after">
                    <group style="width: 65%">
                        <label for="carrier_id" />
                        <div>
                            <field
                name="carrier_id"
                context="{'order_id':active_id or False}"
                class="oe_inline"
              />
                            <button
                name="delivery_set"
                string="Add in Quote"
                type="object"
                class="oe_edit_only"
                attrs="{'invisible':['|',('carrier_id','=',False),('state','not in',('draft','sent'))]}"
              />
                            <br />
                            <label
                string="If you don't 'Add in Quote', the exact price will be computed when invoicing based on delivery order(s)."
                class="oe_edit_only"
                attrs="{'invisible':['|',('carrier_id','=',False),('state','not in',('draft','sent'))]}"
              />
                        </div>
                    </group>
                </xpath>
            </field>
        </record>


        <record model="ir.ui.view" id="logistic_workflow_sale_order_view_form">
            <field name="name">logistic.workflow.sale.order.view.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">

                <page string="Other Information" position="after">
                    <page
            name="automation_information"
            string="Automation Information"
          >
                        <group>
                            <field name="payment_method_id" />
                            <field name="workflow_process_id" />
                            <field name="canceled_in_backend" />
                            <field name="cancellation_resolved" invisible="1" />
                        </group>
                    </page>
                </page>
            </field>
        </record>

        <record model="ir.ui.view" id="logistic_view_order_form">
            <field name="name">logistic.view.order.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">

                <field name="name" position="after">
                    <group>
                        <field
              name="main_exception_id"
              options="{&quot;no_open&quot;: True}"
              class="oe_inline"
              string="Error:"
              attrs="{'invisible':[('main_exception_id','=', False)]}"
            />
                    </group>
                </field>
                <xpath
          expr="//page[@string='Other Information']/group"
          position="inside"
        >
                    <group name="exception" colspan="2" col="2">
                        <separator string="Exception" colspan="2" />
                        <field name="exception_ids" colspan="2" nolabel="1" />
                    </group>
                </xpath>
            </field>
        </record>


        <record model="ir.ui.view" id="logistic_view_order_connector_form">
            <field name="name">logistic.view.order.connector.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">

                <page string="Other Information" position="after">
                    <!-- change the invisible attribute to 0 when used
                         in submodules -->
                    <page name="connector" string="Connectors" invisible="1" />
                </page>
            </field>
        </record>

        <record model="ir.ui.view" id="logistic_sale_order_form_payment">
            <field name="name">logistic.sale.order.form.payment</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">
                <notebook position="before">
                    <field
            name="portal_payment_options"
            groups="portal_sale.group_payment_options"
            class="view_portal_payment_options"
          />
                </notebook>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_view_order_form_inherit">
            <field name="name">logistic.view.order.form.inherit</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">
                <data>
                    <xpath
            expr="//button[@name='invoice_corrected']"
            position="after"
          >
                        <button
              name="ship_recreate"
              states="shipping_except"
              string="Recreate Delivery Order"
            />
                        <button
              name="ship_corrected"
              states="shipping_except"
              string="Ignore Exception"
            />
                    </xpath>
                    <xpath
            expr="//button[@name='action_view_invoice']"
            position="after"
          >
                        <field name="picking_ids" invisible="1" />
                        <button
              name="action_view_delivery"
              string="View Delivery Order"
              type="object"
              class="oe_highlight"
              attrs="{'invisible': ['|',('picking_ids','=',False),('picking_ids','=',[])]}"
              groups="base.group_user"
            />
                    </xpath>
                    <xpath
            expr="//button[@name='action_cancel']"
            position="after"
          >
                        <button
              name="ship_cancel"
              states="shipping_except"
              string="Cancel Order"
            />
                    </xpath>
                    <field name="state" position="attributes">
                        <attribute
              name="statusbar_colors"
              t-translate="off"
            >{"shipping_except":"red","invoice_except":"red","waiting_date":"blue"}</attribute>
                    </field>
                    <field name="company_id" position="replace">
                        <field name="company_id" readonly="True" />
                    </field>
                    <field name="client_order_ref" position="after">
                        <field
              name="warehouse_id"
              on_change="onchange_warehouse_id(warehouse_id)"
              options="{'no_create': True}"
              groups="stock.group_locations"
            />
                    </field>
                    <xpath
            expr="//field[@name='order_line']/form//field[@name='product_id']"
            position="replace"
          >
                        <field
              name="product_id"
              context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':False, 'company_id': parent.company_id}"
              groups="base.group_user"
              on_change="product_id_change_with_wh(parent.pricelist_id,product_id,product_uom_qty,False,product_uos_qty,False,name,parent.partner_id, False, True, parent.date_order, product_packaging, parent.fiscal_position, False, parent.warehouse_id, context)"
            />
                    </xpath>
                    <xpath
            expr="//field[@name='order_line']/tree//field[@name='product_id']"
            position="replace"
          >
                        <field
              name="product_id"
              context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
              groups="base.group_user"
              on_change="product_id_change_with_wh(parent.pricelist_id,product_id,product_uom_qty,False,product_uos_qty,False,name,parent.partner_id, False, True, parent.date_order, product_packaging, parent.fiscal_position, False, parent.warehouse_id, context)"
            />
                    </xpath>
                    <xpath
            expr="//field[@name='order_line']/tree//field[@name='product_uom_qty']"
            position="replace"
          >
                        <field
              context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
              name="product_uom_qty"
              on_change="product_id_change_with_wh(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,False,name,parent.partner_id, False, False, parent.date_order, product_packaging, parent.fiscal_position, True, parent.warehouse_id, context)"
            />
                    </xpath>
                    <xpath
            expr="//field[@name='order_line']/form//field[@name='product_uos_qty']"
            position="replace"
          >
                        <field
              context="{'partner_id':parent.partner_id, 'quantity':product_uos_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
              name="product_uos_qty"
              class="oe_inline"
              on_change="product_id_change_with_wh(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, False, False, parent.date_order, product_packaging, parent.fiscal_position, True, parent.warehouse_id, context)"
            />
                    </xpath>

                    <field name="invoiced" position="after">
                        <field name="shipped" />
                        <field name="invoice_exists" invisible="1" />
                    </field>
                    <xpath
            expr="//page[@string='Order Lines']/field[@name='order_line']/form[@string='Sales Order Lines']/group/group/field[@name='tax_id']"
            position="after"
          >
                        <label for="delay" />
                        <div>
                            <field name="delay" class="oe_inline" />
                            days
                        </div>
                    </xpath>
                    <xpath
            expr="//page[@string='Order Lines']/field[@name='order_line']/form[@string='Sales Order Lines']/group/group/field[@name='tax_id']"
            position="before"
          >
                        <field name="product_tmpl_id" invisible="1" />
                        <field
              name="product_packaging"
              context="{'default_product_tmpl_id': product_tmpl_id, 'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
              on_change="product_packaging_change(parent.pricelist_id, product_id, product_uom_qty, product_uom, parent.partner_id, product_packaging, True, context)"
              domain="[('product_tmpl_id','=',product_tmpl_id)]"
              groups="product.group_stock_packaging"
            />
                    </xpath>
                    <xpath
            expr="//page[@string='Order Lines']/field[@name='order_line']/tree[@string='Sales Order Lines']/field[@name='sequence']"
            position="after"
          >
                        <field name="delay" invisible="1" />
                    </xpath>
                    <xpath
            expr="//page[@string='Order Lines']/field[@name='order_line']/tree[@string='Sales Order Lines']/field[@name='th_weight']"
            position="after"
          >
                        <field name="product_packaging" invisible="1" />
                    </xpath>
                    <xpath
            expr="//group[@name='sales_person']"
            position="before"
          >
                        <group name="logistics">
                            <field
                name="incoterm"
                widget="selection"
                groups="base.group_user"
              />
                            <field name="picking_policy" required="True" />
                            <field name="order_policy" />
                        </group>
                    </xpath>
                    <xpath
            expr="//field[@name='order_line']/form/group/group/field[@name='price_unit']"
            position="before"
          >
                        <field
              name="route_id"
              groups="sale_stock.group_route_so_lines"
            />
                    </xpath>
                    <xpath
            expr="//field[@name='order_line']/tree/field[@name='price_unit']"
            position="before"
          >
                        <field
              name="route_id"
              groups="sale_stock.group_route_so_lines"
            />
                    </xpath>
                </data>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_sale_order_view_form">
            <field name="name">logistic.sale.order.view.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="arch" type="xml">
                <!--                <field name="fiscal_position" position="after">
                    <field name="payment_method_id"/>
                </field>-->

                <field name="amount_total" position="after">
                    <field name="residual" invisible="1" />
                </field>

                <button string="Create Invoice" position="after">
                    <field name="payment_ids" invisible="1" />
                    <button
            name="action_view_payments"
            string="View Automatic Payment"
            type="object"
            class="oe_highlight"
            attrs="{'invisible': [('payment_ids', '=', [[6, False, []]])]}"
            groups="base.group_user"
          />
                </button>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_presta_view_order_form">
            <field name="name">logistic.presta.view.order.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <page string="Other Information" position="inside">
                    <separator string="Prestashop Information" />
                    <field name="prestashop_bind_ids" readonly="True">
                        <tree string="Prestashop Binding">
                            <field name="total_amount" />
                            <field name="total_amount_tax" />
                        </tree>
                    </field>
                </page>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_view_presta_order_form">
            <field name="name">logistic.view.presta.order.form</field>
            <field name="model">sale.order</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_order_btb_form"
      />
            <field name="priority">200</field>
            <field name="arch" type="xml">
                <field name="name" position="before">
                    <field
            name="prestashop_order_id"
            class="oe_inline"
            readonly="1"
            attrs="{'invisible':[('prestashop_order_id','in',(False, 0))]}"
          />
                    <span
            attrs="{'invisible':[('prestashop_order_id','in',(False, 0))]}"
          > / </span>

                </field>

            </field>
        </record>


        <!--************* Invoice ****************-->


        <record model="ir.ui.view" id="l4_logistic_account_invoice_form">
            <field name="name">l4.logistic.account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_invoice_btb_form"
      />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='user_id']" position="after">
                    <field
            name="section_id"
            groups="base.group_multi_salesteams"
          />
                </xpath>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_view_invoice_customer">
            <field name="name">logistic.view.invoice.customer</field>
            <field name="model">account.invoice</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_invoice_btb_form"
      />
            <field name="arch" type="xml">
                <xpath
          expr="//button[@name='invoice_open'][last()]"
          position="after"
        >
                    <button
            name="invoice_pay_customer"
            type="object"
            string="Register Payment"
            attrs="{'invisible': ['|', ('state','!=','open'), ('sent','=',True)]}"
            groups="base.group_user"
          />
                    <button
            name="invoice_pay_customer"
            type="object"
            string="Register Payment"
            attrs="{'invisible': ['|', ('state','!=','open'), ('sent','=',False)]}"
            class="oe_highlight"
            groups="base.group_user"
          />
                </xpath>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_invoice_form_payment">
            <field name="name">logistic.invoice.form.payment</field>
            <field name="model">account.invoice</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_invoice_btb_form"
      />
            <field name="arch" type="xml">
                <notebook position="before">
                    <field
            name="portal_payment_options"
            groups="portal_sale.group_payment_options"
            class="view_portal_payment_options"
          />
                </notebook>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_invoice_form_portal">
            <field name="name">logistic.invoice.form.portal</field>
            <field name="model">account.invoice</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_invoice_btb_form"
      />
            <field name="arch" type="xml">
                <field name="payment_ids" position="replace" />

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_invoice_form_cancel_inherit">
            <field name="name">logistic.invoice.form.cancel.inherit</field>
            <field name="model">account.invoice</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_invoice_btb_form"
      />
            <field name="arch" type="xml">
                <xpath
          expr="//button[@name='invoice_cancel']"
          position="replace"
        >
                    <button
            name="invoice_cancel"
            states="draft,proforma2,sale,open"
            string="Cancel Invoice"
            groups="account.group_account_invoice"
          />
                </xpath>

            </field>
        </record>


        <record model="ir.ui.view" id="logistic_logistic_account_invoice_form">
            <field name="name">logistic.logistic.account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field
        name="inherit_id"
        ref="l4-ezytail-spec.logistic_invoice_btb_form"
      />
            <field name="arch" type="xml">
                <xpath
          expr="//field[@name='invoice_line']"
          position="attributes"
        >
                    <attribute
            name="context"
          >{'type': type,'journal_id':journal_id}</attribute>

                </xpath>

            </field>
        </record>


        <!--         ############### Qweb ############### -->

    </data>
</openerp>
